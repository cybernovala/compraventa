<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Generar PDF Compraventa sin Marca - ADMIN</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 250px; }
    input { width: 100%; padding: 8px; margin-top: 10px; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 1rem; }
  </style>
</head>
<body>
  <h2>Generar PDF Compraventa sin marca de agua (ADMIN)</h2>
  <p>‚ö†Ô∏è Pega aqu√≠ los datos completos en formato JSON (copiados desde <a href="https://curriculum-9s9x.onrender.com/ver_datos" target="_blank">/ver_datos</a>):</p>
  <textarea id="datos"></textarea>
  <br>
  <button onclick="generarPDF()">Generar y Descargar PDF limpio</button>

  <h3>üî¥ Borrar datos de un usuario espec√≠fico</h3>
  <input type="text" id="marca" placeholder='Ej: usuario_1751554601326_820' />
  <button onclick="borrarUsuario()">Borrar Usuario</button>

  <h3>‚ö†Ô∏è Borrar todos los datos</h3>
  <button onclick="borrarDatos()">Borrar todos los datos guardados</button>

  <p id="mensaje"></p>

  <script>
    async function generarPDF() {
      const datosTexto = document.getElementById("datos").value;
      let jsonData;

      try {
        jsonData = JSON.parse(datosTexto);
      } catch (e) {
        alert("‚ö†Ô∏è Los datos no tienen formato JSON v√°lido.");
        return;
      }

      const payload = {
        clave: "@@ADMIN123@@",
        data: jsonData
      };

      const response = await fetch("https://compraventa-5lhy.onrender.com/generar_pdf_admin", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        alert("‚ùå Error: " + (await response.text()));
        return;
      }

      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "contrato_compraventa_sin_marca.pdf";
      document.body.appendChild(a);
      a.click();
      a.remove();
      window.URL.revokeObjectURL(url);
    }

    async function borrarUsuario() {
      const marca = document.getElementById("marca").value.trim();
      if (!marca) {
        alert("‚ö†Ô∏è Debes ingresar la marca del usuario a borrar.");
        return;
      }

      const confirmacion = confirm(`‚ö†Ô∏è ¬øEst√°s seguro de borrar el usuario con marca: ${marca}?`);
      if (!confirmacion) return;

      const payload = {
        clave: "@@ADMIN123@@",
        marca: marca
      };

      const response = await fetch("https://curriculum-9s9x.onrender.com/borrar_usuario", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const resultado = await response.json();
      document.getElementById("mensaje").innerText = resultado.mensaje || "Error al borrar usuario.";
    }

    async function borrarDatos() {
      const confirmacion = confirm("‚ö†Ô∏è ¬øEst√°s seguro de borrar TODOS los datos guardados?");
      if (!confirmacion) return;

      const payload = {
        clave: "@@ADMIN123@@"
      };

      const response = await fetch("https://curriculum-9s9x.onrender.com/borrar_datos", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const resultado = await response.json();
      document.getElementById("mensaje").innerText = resultado.mensaje || "Error al borrar.";
    }
  </script>
</body>
</html>
