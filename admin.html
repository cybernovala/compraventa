<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Admin Compraventa - PDF sin marca</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 250px; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 1rem; }
  </style>
</head>
<body>
  <h2>Generar PDF sin marca de agua - COMPRAVENTA</h2>
  <p>⚠️ Pega aquí el JSON completo del usuario (copiado desde /ver_datos):</p>
  <textarea id="datos"></textarea>
  <br>
  <button onclick="generarPDF()">Generar y Descargar PDF sin marca</button>

  <p id="mensaje"></p>

  <script>
    async function generarPDF() {
      const datosTexto = document.getElementById("datos").value.trim();
      let jsonData;

      try {
        jsonData = JSON.parse(datosTexto);
      } catch (e) {
        alert("⚠️ Los datos no tienen formato JSON válido.");
        return;
      }

      const payload = {
        clave: "@@ADMIN123@@",
        data: jsonData
      };

      try {
        const response = await fetch("https://TU_BACKEND_COMPRAVENTA.onrender.com/generar_pdf_admin", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          alert("❌ Error: " + (await response.text()));
          return;
        }

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "contrato_compraventa_sin_marca.pdf";
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

      } catch (error) {
        alert("❌ Error al generar: " + error);
      }
    }
  </script>
</body>
</html>
